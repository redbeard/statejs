<html>
<head>
<script type="text/javascript" src="../lib/jquery-1.3.2.js" ></script>
<script type="text/javascript" src="../lib/jquery.timers-1.2.js" ></script>
	<script type="text/javascript" src="../lib/state.js" ></script>
	<script type="text/javascript">
	var root = state({
		name: "Root",
		subs: {
			initial: state({ 
				name: "On",
				entry: function() { 
					$("#power_led").fadeIn();
					$('#switch').live("click", function() { 
					root.subs.initial.transitionTo(root.subs.off); 
				}); },
				exit: function() { 
					$("#power_led").fadeOut();
					$("#switch").die("click"); 
				},
				subs: {
					initial: state({
						name: "blink_on",
						entry: function() { 
							$("#blinking_led").fadeIn("fast");
							$(this).oneTime(200, function() { root.subs.initial.subs.initial.transitionTo(root.subs.initial.subs.blink_off); } );
						},
						exit: function() {
							$("#blinking_led").fadeOut("fast");
						}
					}),
					blink_off: state({
						entry: function() { 
							$(this).oneTime(200, function() { root.subs.initial.subs.blink_off.transitionTo(root.subs.initial.subs.initial); } );
						},
						
					})
				} }),
			off: state({
				entry: function() {
					$('#switch').live("click", function() { 
						root.subs.off.transitionTo(root.subs.initial); 
					}); 
				},
				exit: function() { $("#switch").die("click"); },
			}),
		}
	});

	root.start();
	
//	root.currentState().transitionTo(root.subs.off);

</script>
</head>
<body>
	<a id="switch" href="#">
		Switch
	</a>
	<div id="power_led">
		Power Led
	</div>
	<div id="blinking_led">
		Blinking Led
	</div>
</body>
</html>